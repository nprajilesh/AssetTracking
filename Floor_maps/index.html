<!DOCTYPE HTML>

<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
      #container {
        background-color: black;
        background-image: url("ey2.png");
        background-position: 1px 0px;
        background-repeat: no-repeat;
        width: 580px;
        height: 327px;
        float:left; 
      }
      #container2 {
        background-color: gray;
        background-position: 1px 0px;
        background-repeat: no-repeat;
        width: 580px;
        height: 327px;
        float: right;
      }
    
    </style>
  </head>
  <body>
   
    <div id="container"></div><div id="container2"></div>
   
 
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.1.min.js"></script>
    <script defer="defer">
      function getData() {
        return {
          'Basement': {
            color: 'blue',
            points: [49,197,49,179, 378,246, 526,210, 524,235, 377,277]
          },
          'Ground Floor': {
            color: 'red',
            points: [49,179,47,162,380,216,528,185,526,208,378,246]
          },
          'First Floor': {
            color: 'yellow',
            points: [47,162,46,143,382,181,530,159,528,183,380,214]
          }
        }
      }

     
      //indiactes currently selected floor
      var curr_floor=" ";

      //cordinates of first floor zones
       function getDatatop() {
        return {
        'Zone 1': {
            id : 301,
            color: 'ivory',
            points: [3,10,3,320,28,320,28,10]
          },
          'Zone 2': {
            id : 302,
            color: 'ivory',
            points: [28,10,28,32,550,32,550,10]
          },
          'zone 3': {
            id : 303,
            color: 'ivory',
            points: [550,10,550,32,550,320,577,320,577,10]
          },
          'zone 4': {
            id : 304,
            color: 'ivory',
            points: [550,320,550,200,457,200,457,320]
          },
          'zone 5': {
            id : 305,
            color: 'ivory',
            points: [550,200,457,200,457,138,398,138,398,32,550,32]
         },
          'zone 6': {
            id : 306,
            color: 'ivory',
            points: [ 398,138,398,32,182,32,182,138]
       },
          'zone 7': {
            id : 307,
            color: 'ivory',
            points: [ 182,32,182,138,123,138,123,199,28,199,28,32]
          },
          'zone 8': {
            id : 308,
            color: 'ivory',
            points: [ 123,199,28,199,28,320,123,320]
        },
          'zone 9': {
            id : 309,
            color: 'ivory',
            points: [ 123,320,123,138,457,138,457,320,428,320,428,165,150,165,150,320]
        },
          'zone 10': {
            id : 310,
            color: 'ivory',
            points: [ 428,320,428,165,150,165,150,320,215,320,215,184,365,185,365,320]
        }

        }
      }


       //cordinates of second floor zones

        function getDatamiddle() {
        return {
          'Zone 1': {
            id : 201,
            color: '#00FF99',
            points: [2,2,2,143,120,143,120,2]
          },
          'Zone 2': {
            id : 202,
            color: '#00FF99',
            points: [  120,143,2,143,2,313,120,313]
          },
          'zone 3': {
            id : 203,
            color: '#00FF99',
            points: [214,2,120,2,120,125,214,125]
          },
          'zone 4': {
            id : 204,
            color: '#00FF99',
            points: [  120,125,214,125,214,157,428,157,428,313,363,313,363,177,214,177,214,313,120,313]
          },
          'zone 5': {
            id : 205,
            color: '#00FF99',
            points: [ 214,2,214,157,363,157,363,99,428,99,428,2
]
         },
          'zone 6': {
            id : 206,
            color: '#00FF99',
            points: [ 363,99,428,99,428,2,575,2,575,157,363,157]
       },
          'zone 7': {
            id : 207,
            color: '#00FF99',
            points: [428,157,428,313,575,313,575,222,440,222,440,157]
          },
          'zone 8': {
            id : 208,
            color: '#00FF99',
            points: [  440,157,575,157,575,222,440,222]
        },
          'zone 9': {
            id : 209,
            color: '#00FF99',
            points: [  363,313,363,177,214,177,214,313]
        }
      }
    }

       //cordinates of Third floor zones

      function getDatabottom() {
        return {
         '1scct': {
            id : '101',
            color: '#99CCFF',
            points: [300,30,430,30,430,130,300,130]
          }
          
        }
      }


      //Function to draw tooltip at x y cordinate

      function updateTooltip(tooltip, x, y, text) {
        tooltip.getText().text(text);
        tooltip.position({x:x, y:y});
        tooltip.show();
      }

       //Function to draw tooltip2 at x y cordinate

      function updateTooltip2(tooltip2, x, y, text) {
        tooltip2.getText().text(text);
        tooltip2.position({x:x, y:y});
        tooltip2.show();
      }

      //stage for container 1 (EY building)

      var stage = new Kinetic.Stage({
        container: 'container',
        width: 578,
        height: 325
      });

      //shapelayer and tooltiplayer of container 1

      var shapesLayer = new Kinetic.Layer();
      var tooltipLayer = new Kinetic.Layer();


      //tooltip for container1
       var tooltip = new Kinetic.Label({
        opacity: 0.75,
        visible: false,
        listening: false
      });


      //stage for container 2 (floor plans)

      var stage2 = new Kinetic.Stage({
        container: 'container2',
        width: 578,
        height: 325
      });
     

     //shapelayer and tooltiplayer of container 2
      var tooltipLayer2 = new Kinetic.Layer();
      var shapesLayer2 = new Kinetic.Layer();

        
     //tooltip  configuration container 1

      tooltip.add(new Kinetic.Tag({
        fill: 'black',
        pointerDirection: 'down',
        pointerWidth: 10,
        pointerHeight: 10,
        lineJoin: 'round',
        shadowColor: 'black',
        shadowBlur: 10,
        shadowOffset: {x:10,y:10},
        shadowOpacity: 0.5
      }));
      
      tooltip.add(new Kinetic.Text({
        text: '',
        fontFamily: 'Calibri',
        fontSize: 18,
        padding: 5,
        fill: 'white'
      }));
      


      // get areas data of container 1
      var areas = getData();
    
     // draw areas of container1
     for(var key in areas) {

        var area = areas[key];
        var points = area.points;
        var shape = new Kinetic.Line({
          points: points,
          fill: area.color,
          opacity: 0,
          key: key,
          closed: true
        });
         shapesLayer.add(shape);
         tooltipLayer.add(tooltip);

      }

      //add shapes to stage

      stage.add(shapesLayer);
      stage.add(tooltipLayer);

      //tooltip2 for container 2

     var tooltip2 = new Kinetic.Label({
        opacity: 0.75,
        visible: false,
        listening: false
      });
        
      tooltip2.add(new Kinetic.Tag({
        fill: 'black',
        pointerDirection: 'down',
        pointerWidth: 10,
        pointerHeight: 10,
        lineJoin: 'round',
        shadowColor: 'black',
        shadowBlur: 10,
        shadowOffset: {x:10,y:10},
        shadowOpacity: 0.5
      }));
      
      tooltip2.add(new Kinetic.Text({
        text: '',
        fontFamily: 'Calibri',
        fontSize: 18,
        padding: 5,
        fill: 'white'
      }));


      
      
      //updates region in selected floor
      
       function updatepoints()
       {

          
             var areas2;
             shapesLayer2.destroyChildren();
            tooltipLayer2.remove();
           
          
           if(curr_floor=="Basement")
                 areas2 = getDatabottom();
           else if(curr_floor=="Ground Floor")
                 areas2 = getDatamiddle();
           else if(curr_floor=="First Floor")
                 areas2 = getDatatop();
           

          //draw area of selected floor
                 for(var key in areas2) 
                 {

                        var area = areas2[key];
                        var points = area.points;

                        var shape = new Kinetic.Line({
                          points: points,
                          fill: area.color,
                          opacity: 0,
                          // custom attr
                          key: key,
                          id: area.id,
                          closed: true
                      
                         });
         
                      shapesLayer2.add(shape);
                      tooltipLayer2.add(tooltip2);

                }
            
            //add shape to stage2
             stage2.add(shapesLayer2);
             stage2.add(tooltipLayer2);
             
             
       }
      

       //mouse over function for container 1

      stage.on('mouseover', function(evt)
       {
          var shape = evt.targetNode;
         if (shape)
         {
           shape.setOpacity(0.5);
           shapesLayer.draw();
         }
      });


      //mouse out event for container 1

      stage.on('mouseout', function(evt) 
      {
      
        var shape = evt.targetNode;
        if (shape)
         {
             shape.opacity(0);
             shapesLayer.draw();
             tooltip.hide();
             tooltipLayer.draw();
        }
      });


      //mouse move function for container 1

      stage.on('mousemove', function(evt)
       {
            var shape = evt.targetNode;
            if (shape) 
            {
                  var mousePos = stage.getPointerPosition();
                  var x = mousePos.x;
                  var y = mousePos.y - 5;
                  updateTooltip(tooltip, x, y, shape.getAttr('key'));
                  tooltipLayer.batchDraw();
          
            }
      });


      //mouse out function for container 2

      stage2.on('mouseout', function(evt)
      {
           var shape = evt.targetNode;
           if (shape)
            {
                shape.opacity(0);
                shapesLayer2.draw();
                tooltip2.hide();
                tooltipLayer2.draw();
            }
      });

   

      //mouse move function for container 2

      stage2.on('mousemove', function(evt) 
      {
            var shape = evt.targetNode;
            if (shape) 
            {
                  var mousePos = stage2.getPointerPosition();
                  var x = mousePos.x;
                  var y = mousePos.y - 5;
                   updateTooltip2(tooltip2, x, y, shape.getAttr('key'));
                  tooltipLayer2.batchDraw();
                 
            }
      }); 

      //mouse over function for container 2

     stage2.on('mouseover', function(evt)
      {
           var shape = evt.targetNode;
           if (shape) 
           {
               shape.setOpacity(0.5);
               shapesLayer2.draw();
           }
      });
  

     //onclick function for container 1
 
     stage.on('click', function(evt) 
     {
        var shape = evt.targetNode;

        if (shape)
         {
                curr_floor=shape.getAttr('key');
                updatepoints();
              if(shape.getAttr('key')=="Basement")
                    document.getElementById("container2").style.backgroundImage = "url('bottom.png')";
              else if(shape.getAttr('key')=="Ground Floor")
                    document.getElementById("container2").style.backgroundImage = "url('middle.png')";
              else if(shape.getAttr('key')=="First Floor")
                    document.getElementById("container2").style.backgroundImage = "url('top.png')";
              else
                     document.getElementById("container2").style.backgroundImage = "";
        }

      });

      //onclick function for container 2


     stage2.on('click', function(evt)
      {

           var shape = evt.targetNode;
           if (shape) 
           {
               var zone_id=shape.getAttr('id');
               console.log(zone_id);
           }
      });

    </script>
  </body>
</html>