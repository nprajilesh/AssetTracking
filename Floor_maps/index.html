<!DOCTYPE HTML>

<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
      #container {
        background-color: black;
        background-image: url("ey2.png");
        background-position: 1px 0px;
        background-repeat: no-repeat;
        width: 580px;
        height: 327px;
        float:left; 
      }
      #container2 {
        background-color: gray;
        background-position: 1px 0px;
        background-repeat: no-repeat;
        width: 580px;
        height: 327px;
        float: right;
      }
      #topcontainer
      {
        background-color: yellow;
        background-repeat: no-repeat;
        width: 100%;
        height: 327px;
      }
    </style>
  </head>
  <body>
   
    <div id="container"></div><canvas id="container2"></canvas>
   
 
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.1.min.js"></script>
    <script defer="defer">
      function getData() {
        return {
          '1st Floor': {
            color: 'blue',
            points: [49,197,49,179, 378,246, 526,210, 524,235, 377,277]
          },
          '2nd Floor': {
            color: 'red',
            points: [49,179,47,162,380,216,528,185,526,208,378,246]
          },
          '3rd Floor': {
            color: 'yellow',
            points: [47,162,46,143,382,181,530,159,528,183,380,214]
          }
        }
      }
      function updateTooltip(tooltip, x, y, text) {
        tooltip.getText().text(text);
        tooltip.position({x:x, y:y});
        tooltip.show();
      }


      var stage = new Kinetic.Stage({
        container: 'container',
        width: 578,
        height: 325
      });
      var shapesLayer = new Kinetic.Layer();
      var tooltipLayer = new Kinetic.Layer();
      
      var tooltip = new Kinetic.Label({
        opacity: 0.75,
        visible: false,
        listening: false
      });
      
      tooltip.add(new Kinetic.Tag({
        fill: 'black',
        pointerDirection: 'down',
        pointerWidth: 10,
        pointerHeight: 10,
        lineJoin: 'round',
        shadowColor: 'black',
        shadowBlur: 10,
        shadowOffset: {x:10,y:10},
        shadowOpacity: 0.5
      }));
      
      tooltip.add(new Kinetic.Text({
        text: '',
        fontFamily: 'Calibri',
        fontSize: 18,
        padding: 5,
        fill: 'white'
      }));
      
      tooltipLayer.add(tooltip);

      // get areas data
      var areas = getData();

      // draw areas
      for(var key in areas) {

        var area = areas[key];
        var points = area.points;

        var shape = new Kinetic.Line({
          points: points,
          fill: area.color,
          opacity: 0,
          // custom attr
          key: key,
          closed: true
        });

        shapesLayer.add(shape);

      }

      stage.add(shapesLayer);
      stage.add(tooltipLayer);

      


      stage.on('mouseover', function(evt) {
        var shape = evt.targetNode;
        if (shape) {
          shape.setOpacity(0.5);
          shapesLayer.draw();
        }
      });
      stage.on('mouseout', function(evt) {
        var shape = evt.targetNode;
        if (shape) {
          shape.opacity(0);
          shapesLayer.draw();
          tooltip.hide();
          tooltipLayer.draw();
        }
      });
      stage.on('mousemove', function(evt) {
        var shape = evt.targetNode;
        if (shape) {
          var mousePos = stage.getPointerPosition();
          var x = mousePos.x;
          var y = mousePos.y - 5;
          updateTooltip(tooltip, x, y, shape.getAttr('key'));
          tooltipLayer.batchDraw();
          
          //mouseToText.setText("Mouse: x="+mouseX+", y="+mouseY);
        }
      }); 
       stage.on('click', function(evt) {
        var shape = evt.targetNode;
        if (shape) {
          console.log("clicked" + shape.getAttr('key'));
          var can = document.getElementById('container2');
          var ctx = can.getContext('2d');
          var img = new Image();
          img.onload = function(){
              can.width = img.width;
              can.height = img.height;
              ctx.drawImage(img, 0, 0, img.width, img.height);
          }

          if(shape.getAttr('key')=="1st Floor")
                img.src="base.png"
          else if(shape.getAttr('key')=="2nd Floor")
                img.src="gf.png"
          else if(shape.getAttr('key')=="3rd Floor")
                img.src="ff.png";
          
          else
             document.getElementById("container2").style.backgroundImage = "";

        }
      });
      
    </script>
  </body>
</html>